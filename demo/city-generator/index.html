<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@knt5"><meta name="twitter:creator" content="@knt5"><meta name="twitter:title" content="City Generator"><meta name="twitter:description" content="A tech demo to predict height of buildings in real time on web browser and generate 3D city"><meta name="twitter:image:src" content="https://knt5.github.io/assets/img/twitter/summary-large-image/city-generator.png"><meta property="fb:app_id" content="250930348604246"><meta property="og:url" content="https://knt5.github.io/demo/city-generator/"><meta property="og:type" content="website"><meta property="og:title" content="City Generator"><meta property="og:description" content="A tech demo to predict height of buildings in real time on web browser and generate 3D city"><meta property="og:image" content="https://knt5.github.io/assets/img/twitter/summary-large-image/city-generator.png"><meta property="og:image:width" content="560"><meta property="og:image:height" content="300"><title>City Generator</title><link rel="icon" type="image/png" href="assets/img/favicon.png"><link rel="apple-touch-icon" type="image/png" href="assets/img/favicon.png"><style>html,body,div,span,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,abbr,address,cite,code,del,dfn,em,img,ins,kbd,q,samp,small,strong,sub,sup,var,b,i,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,figcaption,figure,footer,header,hgroup,menu,nav,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}ol,ul{padding-left:20px}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}nav ul{list-style:none}blockquote,q{quotes:none}blockquote::before,blockquote::after,q::before,q::after{content:none}a{margin:0;padding:0;font-size:100%;vertical-align:baseline;background:transparent}ins{background-color:#ff9;color:#000;text-decoration:none}mark{background-color:#ff9;color:#000;font-style:italic;font-weight:bold}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}hr{display:block;height:1px;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}input,select{vertical-align:middle}*,*::before,*::after{box-sizing:border-box}body{background:#000;color:#fff;font-size:14px;line-height:1.4;-webkit-text-size-adjust:100%}body,input,select,textarea,th,td{font-family:"Myriad Pro", "Lucida Grande", "GillSans", "Hiragino Kaku Gothic Pro", "Meiryo", "sans-serif"}a{color:#3af}a:link,a:visited,a:active{text-decoration:none}a:hover{text-decoration:underline}.clearfix::after{content:'';display:block;clear:both}.city-canvas{position:absolute;top:0;left:0}.city-canvas-status{display:none;position:absolute;top:0;left:0;background:#333;opacity:.7;color:#fff;font-size:16px;text-align:center;vertical-align:middle}.city-canvas-status-text{position:absolute;text-align:center;width:100%}.building-preview{display:none;position:absolute;top:0;left:0;opacity:.5;pointer-events:none}.building-canvas{box-sizing:content-box;display:none;position:absolute;border:4px solid #fff;pointer-events:all}.user-interface{pointer-events:none;position:absolute;top:0;left:0}.header{pointer-events:none;padding:8px 72px 0 14px;z-index:1000}.header h1{font-size:30px;font-weight:normal}.header p{font-size:14px}.header a{pointer-events:all}.facebook{margin-top:12px}.facebook iframe{pointer-events:all}@media (max-width: 415px){.header{padding:6px 32px 0 8px}}.data-source{position:absolute;font-size:10px;left:0;bottom:0;padding-left:3px}.map{pointer-events:all;position:absolute;right:0;bottom:0;width:360px;height:320px;opacity:.9}@media (max-width: 415px){.map{width:100%;height:100px}}.city-select-box{position:relative;margin:-12px 0 0 14px}.city-select-title{float:left;margin-top:4px}.city-select{pointer-events:all;display:block;float:left;margin-left:6px;padding:3px 6px;background:#fff;color:#000}.rotation-checkbox-box{pointer-events:all;display:block;float:left;margin-left:6px;padding-top:3px}@media (max-width: 415px){.city-select-box{position:absolute;bottom:70px;margin-left:6px}}.stage{position:relative;overflow:hidden}@media (max-width: 415px){.github-ribbon img{width:74px;height:74px}}</style></head><body><div id="stage" class="stage"><div id="city-canvas" class="city-canvas"></div><div id="city-canvas-status" class="city-canvas-status"><div id="city-canvas-status-text" class="city-canvas-status-text"></div></div><div id="building-preview" class="building-preview"><div id="building-canvas" class="building-canvas"></div></div><div id="user-interface" class="user-interface"><header id="header" class="header"><h1>City Generator</h1><p>A tech demo to predict height of buildings in real time on web browser and generate 3D city ➔ <a href="https://github.com/knt5/city-generator/blob/master/README.md" target="_blank">more info</a></p><div class="facebook"><iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fknt5.github.io%2Fdemo%2Fcity-generator%2F&width=149&layout=button_count&action=like&show_faces=false&share=true&height=46&appId=250930348604246" width="149" height="46" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowtransparency="true"></iframe></div></header><div class="data-source">Source: 国土地理院の基盤地図情報基本項目/建築物の外周線と数値標高モデルを使用。また JAXA ALOS の DSM を使用。</div><div id="map" class="map"></div><div class="city-select-box clearfix"><div class="city-select-title">City :</div><select id="city-select" class="city-select"></select><div class="rotation-checkbox-box"><label><input type="checkbox" id="rotation-checkbox">Rotation</label></div></div></div></div><div class="github-ribbon"><a href="https://github.com/knt5/city-generator"><img style="position: absolute; top: 0; right: 0; border: 0" src="https://camo.githubusercontent.com/52760788cde945287fbb584134c4cbc2bc36f904/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"></a></div><script src="assets/js/lib/jquery.min.js?v=3.0.0"></script><script src="assets/js/lib/three.min.js?v=r76"></script><script src="assets/js/lib/TrackballControls.min.js?commit=3aa9619abca779001e4dbe01be92253229285e2c"></script><script src="assets/js/lib/dat.gui.min.js?v=0.5.1"></script><script>!function e(t,i,n){function a(o,r){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return a(i?i:e)},c,c.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var a=e("index/models/app/app"),s=n(a);s["default"].controller.setup()},{"index/models/app/app":7}],2:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("index/models/stage/stage"),r=n(o),l=e("index/utils/facebookUtil"),u=n(l),c=e("index/controllers/stage/StageController"),d=n(c),h=function(){function e(){a(this,e)}return s(e,[{key:"setup",value:function(){r["default"].controller=new d["default"],window.initMap=function(){r["default"].mapController.init()},$(window).on("resize",this.onResize),this.onResize(),r["default"].cityCanvasController.init()}},{key:"onResize",value:function(){var e=$(window),t=e.width(),i=e.height();u["default"].isFacebookApp()&&(i-=110),r["default"].controller.resizeStage(t,i)}}]),e}();i["default"]=h},{"index/controllers/stage/StageController":6,"index/models/stage/stage":12,"index/utils/facebookUtil":16}],3:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("index/models/stage/stage"),r=n(o),l=e("index/models/stage/dom"),u=e("index/utils/deviceUtil"),c=n(u),d=e("index/three/CityControls"),h=n(d),f=Math.PI,m=function(){function e(){a(this,e),this.rotationChecked=l.$rotationCheckbox.prop("checked")}return s(e,[{key:"init",value:function(){var e=this;this.renderer=new THREE.WebGLRenderer,this.renderer.setSize(l.$cityCanvas.width(),l.$cityCanvas.height()),this.renderer.setPixelRatio(c["default"].getPixelRatio()),l.$cityCanvas.append(this.renderer.domElement);var t=new THREE.CubeTextureLoader;t.load(["assets/img/env/top-right.png","assets/img/env/top-right.png","assets/img/env/bottom-right.png","assets/img/env/black.png","assets/img/env/black.png","assets/img/env/black.png"],function(t){e.envMap=t}),this.cityControls=new h["default"](l.$cityCanvas)}},{key:"rebuild",value:function(e){this.city=e,this.scene&&delete this.scene,this.scene=new THREE.Scene,this.scene.autoUpdate=!1,this.scene.fog=new THREE.Fog(16777215,10,500),this.camera&&delete this.camera,this.camera=new THREE.PerspectiveCamera(45,l.$cityCanvas.width()/l.$cityCanvas.height(),1,1e3),this.camera.position.set(0,-50,50),this.camera.lookAt(this.scene.position),this.scene.add(this.city.ground.mesh),this.changeControls(),this.directionalLight&&delete this.directionalLight,this.directionalLight=new THREE.DirectionalLight(16777215,3),this.directionalLight.position.set(-80,100,200),this.scene.add(this.directionalLight),this.eastDirectionalLight&&delete this.eastDirectionalLight,this.eastDirectionalLight=new THREE.DirectionalLight(15831154,2),this.eastDirectionalLight.position.set(80,20,80),this.scene.add(this.eastDirectionalLight),this.westDirectionalLight&&delete this.westDirectionalLight,this.westDirectionalLight=new THREE.DirectionalLight(15198187,2),this.westDirectionalLight.position.set(80,20,80),this.scene.add(this.westDirectionalLight),this.ambientLight&&delete this.ambientLight,this.ambientLight=new THREE.AmbientLight(16777215),this.scene.add(this.ambientLight),this.render()}},{key:"changeControls",value:function(){this.rotationChecked=l.$rotationCheckbox.prop("checked"),this.rotationChecked?(this.cityControls.dispose(),this.trackball&&(this.trackball.dispose(),delete this.trackball),this.trackball=new THREE.TrackballControls(this.camera,l.$cityCanvas.get(0)),this.trackball.staticMoving=!0):(this.trackball&&(this.trackball.dispose(),delete this.trackball),this.cityControls.init(),this.cityControls.setCamera(this.camera))}},{key:"render",value:function(){var e=r["default"].cityCanvasController;this.rotationChecked?e.trackball.update():e.cityControls.update(),e.scene.updateMatrixWorld(),e.renderer.render(e.scene,e.camera)}},{key:"animate",value:function(){var e=r["default"].cityCanvasController;f+=.01;for(var t in e.city.meshes){var i=.8*Math.cos(f+1.5*parseInt(t));1===t?0>i&&(i=0):i=Math.abs(i),e.city.meshes[t].material.emissiveIntensity=i}e.render(),e.stopAnimationSignal||(e.requestId=requestAnimationFrame(e.animate))}},{key:"stopAnimation",value:function(){var e=r["default"].cityCanvasController;e.requestId&&cancelAnimationFrame(e.requestId)}},{key:"resize",value:function(e,t){this.camera&&this.renderer&&(this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t))}}]),e}();i["default"]=m},{"index/models/stage/dom":10,"index/models/stage/stage":12,"index/three/CityControls":13,"index/utils/deviceUtil":15}],4:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("index/models/stage/dom"),o=function(){function e(){n(this,e)}return a(e,[{key:"show",value:function(e,t){void 0===e&&(e=""),s.$cityCanvasStatusText.text(e),s.$cityCanvasStatus.css("display","table-cell"),t&&setTimeout(t,1)}},{key:"showFailedToLoad",value:function(){this.show("Failed to load, please reload the page.")}},{key:"hide",value:function(){s.$cityCanvasStatus.css("display","none")}}]),e}();i["default"]=o},{"index/models/stage/dom":10}],5:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){e.points=[],e.canvas=document.createElement("canvas"),e.canvas.width=e.image.width,e.canvas.height=e.image.height;var t=e.canvas.getContext("2d");t.drawImage(e.image,0,0);for(var i=t.getImageData(0,0,e.image.width,e.image.height),n=0;n<e.image.height;n++){e.points.push([]);for(var a=0;a<e.image.width;a++)e.points[n].push(i.data[4*a+(e.image.height-n-1)*e.image.width*4])}}function o(e){f["default"].map.data.addGeoJson(e.geo),f["default"].map.data.setStyle(c),r(e.center)}function r(e){f["default"].map.setCenter(e)}function l(){}function u(e){e.dsm.bounds={south:e.dsm.lat,west:e.dsm.lng,north:e.dsm.lat+e.dsm.height*e.dsm.size,east:e.dsm.lng+e.dsm.width*e.dsm.size},e.dsm.overlay=new google.maps.GroundOverlay(e.dsm.image.src,e.dsm.bounds),e.dsm.overlay.setOpacity(.7),e.dsm.overlay.setMap(f["default"].map)}function c(e){var t=e.getProperty("type"),i={strokeWeight:1};switch(t){case 0:i.fillColor="#ffec47",i.strokeColor="#ffec47";break;case 1:i.fillColor="#93ca76",i.strokeColor="#93ca76";break;case 2:i.fillColor="#ec6800",i.strokeColor="#ec6800";break;case 3:i.fillColor="#2ca9e1",i.strokeColor="#2ca9e1"}return i}Object.defineProperty(i,"__esModule",{value:!0});var d=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),h=e("index/models/stage/stage"),f=n(h),m=e("index/models/stage/cities"),g=n(m),v=function(){function e(t){a(this,e),this.$map=t}return d(e,[{key:"init",value:function(){var e=this.$map.get(0);f["default"].map=new google.maps.Map(e,{center:{lat:35.67510369,lng:139.76808639},zoom:15}),f["default"].map.data.addListener("mouseover",function(e){f["default"].map.data.revertStyle(),f["default"].map.data.overrideStyle(e.feature,{fillColor:"#fff",strokeColor:"#a0d8ef",strokeWeight:3})}),f["default"].map.data.addListener("mouseout",function(){f["default"].map.data.revertStyle()}),f["default"].map.data.addListener("click",function(e){var t=f["default"].cityCanvasController.cityControls,i=e.feature.getProperty("fid"),n=f["default"].cityCanvasController.city,a=n.buildings[i];t.setCameraPosition(a.center.x,a.center.y)}),f["default"].controller.onChangeCitySelect()}},{key:"changeCity",value:function(e,t){var i=g["default"][e];i.geo?(r(i.center),t(i)):f["default"].cityCanvasStatusController.show("Loading...",function(){$.getJSON("assets/dat/"+e+".geojson").done(function(n){i.geo=n;var a=i.dem;i.center={lat:a.lat+a.size*(a.height/2),lng:a.lng+a.size*(a.width/2)},l(),o(i);var r=new Image;r.src="assets/dat/"+e+".dsm.png",r.onerror=f["default"].cityCanvasStatusController.showFailedToLoad,r.onload=function(){i.dsm.image=r,s(i.dsm),u(i);var n=new Image;n.src="assets/dat/"+e+".dem.png",n.onerror=f["default"].cityCanvasStatusController.showFailedToLoad,n.onload=function(){i.dem.image=n,s(i.dem),t(i)}}}).fail(f["default"].cityCanvasStatusController.showFailedToLoad)})}}]),e}();i["default"]=v},{"index/models/stage/cities":9,"index/models/stage/stage":12}],6:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("index/models/stage/stage"),r=n(o),l=e("index/models/stage/cities"),u=n(l),c=e("index/models/stage/dom"),d=e("./MapController"),h=n(d),f=e("./CityCanvasController"),m=n(f),g=e("./CityCanvasStatusController"),v=n(g),y=e("index/utils/cityUtil"),p=n(y),C=function(){function e(){a(this,e),r["default"].mapController=new h["default"](c.$map),r["default"].cityCanvasController=new m["default"],r["default"].cityCanvasStatusController=new v["default"];for(var t in u["default"]){var i="";i+='<option value="'+t+'">'+u["default"][t].name+"</option>",c.$citySelect.append(i)}r["default"].cityCanvasController.init(),c.$citySelect.on("change",this.onChangeCitySelect),c.$rotationCheckbox.on("change",function(){r["default"].cityCanvasController.changeControls()})}return s(e,[{key:"resize",value:function(e,t,i){e.width(t),e.height(i)}},{key:"resizeStage",value:function(e,t){this.resize(c.$stage,e,t),this.resize(c.$cityCanvas,e,t),this.resize(c.$cityCanvasStatus,e,t),this.resize(c.$buildingPreview,e,t),this.resize(c.$userInterface,e,t),r["default"].cityCanvasController.resize(e,t),c.$cityCanvasStatusText.css("top",t/2-40+"px")}},{key:"onChangeCitySelect",value:function(){var e=c.$citySelect.val();r["default"].mapController.changeCity(e,function(e){r["default"].cityCanvasController.stopAnimation(),void 0===e.south&&p["default"].updateCity(e),r["default"].cityCanvasController.rebuild(e),r["default"].cityCanvasStatusController.show("Predicting and generating...",function(){p["default"].addCityToScene(e),r["default"].cityCanvasController.animate(),r["default"].cityCanvasStatusController.hide()})})}}]),e}();i["default"]=C},{"./CityCanvasController":3,"./CityCanvasStatusController":4,"./MapController":5,"index/models/stage/cities":9,"index/models/stage/dom":10,"index/models/stage/stage":12,"index/utils/cityUtil":14}],7:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var a=e("index/controllers/app/AppController"),s=n(a);i["default"]={controller:new s["default"]}},{"index/controllers/app/AppController":2}],8:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t,i){var n=[],a=!0,s=!1,r=void 0;try{for(var l,u=e[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;n.push(o(c,t,i))}}catch(d){s=!0,r=d}finally{try{!a&&u["return"]&&u["return"]()}finally{if(s)throw r}}return n}function o(e,t,i){var n=0,a=void 0,s=!0,o=!1,l=void 0;try{for(var u,c=e[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var d=u.value;0===n?a=new THREE.Shape(r(d,t,i)):a.holes.push(new THREE.Path(r(d,t,i))),n++}}catch(h){o=!0,l=h}finally{try{!s&&c["return"]&&c["return"]()}finally{if(o)throw l}}return a}function r(e,t,i){var n=[],a=!0,s=!1,o=void 0;try{for(var r,u=e[Symbol.iterator]();!(a=(r=u.next()).done);a=!0){var d=r.value,h=i.bounds.start.x+c["default"].getMeterFromDeltaLng(d[0]-i.west,d[1])/10,f=i.bounds.start.y+c["default"].getMeterFromDeltaLat(d[1]-i.south,d[1])/10;n.push(new THREE.Vector2(h,f)),l(e,t)}}catch(m){s=!0,o=m}finally{try{!a&&u["return"]&&u["return"]()}finally{if(s)throw o}}return n}function l(e,t){var i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var r=s.value;r[0]<t.west&&(t.west=r[0]),r[1]<t.south&&(t.south=r[1]),r[0]>t.east&&(t.east=r[0]),r[1]>t.north&&(t.north=r[1])}}catch(l){n=!0,a=l}finally{try{!i&&o["return"]&&o["return"]()}finally{if(n)throw a}}}Object.defineProperty(i,"__esModule",{value:!0});var u=e("index/utils/projectionUtil"),c=n(u),d=e("index/utils/heightPredictionUtil"),h=n(d),f=function m(e,t){a(this,m);var i=e.geometry.coordinates,n=e.geometry.type;this.south=1e3,this.west=1e3,this.north=-1e3,this.east=-1e3,"MultiPolygon"===n?this.shape=s(i,this,t):"Polygon"===n?this.shape=o(i,this,t):console.error("Unkown feature geometry type: "+n),this.deltaLat=this.north-this.south,this.deltaLng=this.east-this.west,this.center={lat:this.north-this.deltaLat/2,lng:this.east-this.deltaLng/2},this.center.x=c["default"].getMeterFromDeltaLng(this.center.lng-t.center.lng,t.center.lat)/10,this.center.y=c["default"].getMeterFromDeltaLat(this.center.lat-t.center.lat,t.center.lat)/10,this.height=h["default"].getHeight(e,this,t)};i["default"]=f},{"index/utils/heightPredictionUtil":17,"index/utils/projectionUtil":18}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i["default"]={tokyo:{name:"Tokyo (東京)",dsm:{width:53,height:58,lng:139.759444444444,lat:35.673611111111,size:.000277777778},dem:{width:267,height:288,lng:139.759555555544,lat:35.673611111205,size:55555555e-12}},asakusa:{name:"Asakusa (浅草)",dsm:{width:31,height:27,lng:139.794166666667,lat:35.708611111111,size:.000277777778},dem:{width:154,height:135,lng:139.794222222168,lat:35.70838888894,size:55555555e-12}},shinjuku:{name:"Shinjuku (新宿)",dsm:{width:52,height:45,lng:139.689444444444,lat:35.6825,size:.000277777778},dem:{width:262,height:226,lng:139.68955555563,lat:35.682222222306,size:55555555e-12}},shibuya:{name:"Shibuya (渋谷)",dsm:{width:45,height:38,lng:139.695833333333,lat:35.6525,size:.000277777778},dem:{width:225,height:188,lng:139.69605555573,lat:35.652388889187,size:55555556e-12}},odaiba:{name:"Odaiba (お台場)",dsm:{width:121,height:84,lng:139.768888888889,lat:35.614444444444,size:.000277777778},dem:{width:605,height:421,lng:139.768888888866,lat:35.6143333335,size:55555555e-12}},"tokyo-dome":{name:"Tokyo dome (東京ドーム)",dsm:{width:36,height:28,lng:139.749166666667,lat:35.701666666667,size:.000277777778},dem:{width:181,height:139,lng:139.749333333334,lat:35.701555555615,size:55555555e-12}},"tokyo-university":{name:"Tokyo university (東京大学)",dsm:{width:38,height:40,lng:139.758333333333,lat:35.706944444444,size:.000277777778},dem:{width:192,height:200,lng:139.758333333323,lat:35.706944444497,size:55555555e-12}},ueno:{name:"Ueno (上野)",dsm:{width:41,height:43,lng:139.769722222222,lat:35.709722222222,size:.000277777778},dem:{width:205,height:213,lng:139.769722222198,lat:35.709666666716,size:55555555e-12}}}},{}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.$stage=$("#stage"),i.$cityCanvas=$("#city-canvas"),i.$cityCanvasStatus=$("#city-canvas-status"),i.$cityCanvasStatusText=$("#city-canvas-status-text"),i.$buildingPreview=$("#building-preview"),i.$userInterface=$("#user-interface"),i.$rotationCheckbox=$("#rotation-checkbox"),i.$buildingCanvas=$("#building-canvas"),i.$header=$("#header"),i.$citySelect=$("#city-select"),i.$map=$("#map")},{}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i["default"]={"20150918-50313-12843-s-2328":60,"20150918-50313-12843-s-2326":50,"20150918-50313-12843-s-3089":170,"20150918-50313-12843-s-2299":147,"20150918-50313-12843-s-2329":99.8,"20150918-50313-12843-s-2303":164.1,"20150918-50313-12843-s-2302":110.65,"20150918-50313-12843-s-2301":10,"20150918-50313-12843-s-2286":179.2,"20150918-50313-12843-s-2283":197.6,"20150918-50313-12843-s-2282":125,"20150918-50313-12846-s-3518":90,"20150918-50313-12846-s-3516":80,"20150918-50313-12846-s-3519":150,"20150918-50313-12846-s-3510":150,"20150918-50313-12846-s-3500":199.7,"20150918-50313-12846-s-3496":105.7,"20150918-50313-12846-s-3494":105.7,"20150918-50313-12846-s-3502":138,"20150918-50313-12846-s-3487":146,"20150918-50313-12846-s-3486":200,"20150918-50313-12846-s-3475":80,"20150918-50313-12846-s-3474":154,"20150918-50313-12846-s-3479":177,"20150918-50313-12846-s-3469":122,"20150918-50313-12846-s-3468":135,"20150918-50313-12846-s-3466":110,"20150918-50313-12846-s-3483":100,"20150918-50313-12846-s-3490":39,"20150918-50313-12846-s-3505":92,"20150918-50313-12846-s-3492":100,"20150918-50313-12846-s-3491":114,"20150918-50313-12846-s-3520":158.85,"20150918-50316-12846-s-6087":147.43,"20150918-50316-12846-s-6088":85,"20150918-50313-12846-s-3517":85,"20150918-50313-12846-s-3514":86,"20150918-50313-12846-s-3512":119.92,"20150918-50316-12846-s-6005":166.1,"20150918-50316-12846-s-6012":60,"20150918-50316-12843-s-4213":178,"20150918-50316-12846-s-6013":99.6,"20150918-50316-12846-s-6014":135,"20150918-50316-12843-s-4233":135,"20150918-50316-12846-s-5993":51.4,"20150918-50316-12846-s-5991":119.65,"20150918-50316-12846-s-5996":84,"20150918-50316-12843-s-4170":100,"20150918-50316-12843-s-4314":75,"20150918-50316-12843-s-5098":149.8,"20150918-50316-12843-s-4559":205,"20150918-50316-12843-s-4299":204.9,"20150918-50316-12843-s-4785":70,"20150918-50316-12843-s-5100":70,"20150918-50316-12843-s-5027":50,"20150918-50316-12843-s-4958":43,"20150918-50316-12843-s-4930":60,"20150918-50316-12843-s-4668":40,"20150918-50328-12855-s-10129":84.71,"20150918-50328-12855-s-10191":98.75,"20150918-50328-12855-s-10131":94.9,"20150918-50328-12855-s-10157":40,"20150918-50328-12855-s-10182":20,"20150918-50325-12855-s-12798":30,"20150918-50325-12855-s-10743":29.4,"20150918-50325-12855-s-12265":53.32,"20150918-50325-12855-s-12243":40,"20150918-50310-12852-s-13110":155,"20150918-50310-12852-s-13096":110,"20150918-50331-12855-s-14329":158,"20150918-50331-12855-s-14324":35,"20150918-50331-12855-s-14328":634,"20150918-50331-12855-s-14336":300,"20150918-50331-12855-s-14335":300,"20150918-50331-12855-s-14337":300,"20150918-50316-12822-s-3244":119,"20150918-50316-12825-s-2087":80,"20150918-50319-12825-s-4932":123.45,"20150918-50319-12825-s-4804":114,"20150918-50319-12825-s-4802":113.025,"20150918-50319-12825-s-4790":110,"20150918-50319-12825-s-4789":110,"20150918-50319-12825-s-4806":100,"20150918-50319-12825-s-4787":100,"20150918-50319-12828-s-1601":100,"20150918-50319-12828-s-1603":100,"20160310-50286-12846-s-6458":235,"20160310-50289-12846-s-4720":180,"20160310-50286-12846-s-6456":243,"20160310-50289-12846-s-4790":25,"20160310-50286-12846-s-6520":25,"20160310-50289-12846-s-3616":27,"20160310-50289-12846-s-3673":27,"20160310-50289-12846-s-3636":30,"20160310-50286-12849-s-9759":112,"20160310-50286-12846-s-6454":112,"20160310-50289-12846-s-4150":210.3,"20160310-50289-12849-s-8901":224.9,"20160310-50289-12846-s-4715":178,"20160310-50289-12846-s-4719":133,"20160310-50289-12849-s-8924":222.95,"20160310-50289-12846-s-4718":164.7,"20160310-50289-12846-s-4717":123.35,"20160310-50289-12846-s-4722":95,"20160310-50289-12849-s-7675":200,"20160310-50289-12849-s-7715":209.9,"20160310-50289-12849-s-8926":203.65,"20160310-50289-12849-s-8910":40,"20160310-50289-12849-s-7730":121,"20160310-50289-12846-s-4724":161,"20160310-50289-12846-s-4721":140,"20160310-50289-12846-s-4730":134,"20160310-50292-12846-s-4056":150.75,"20160310-50289-12846-s-4728":111.6,"20160310-50289-12846-s-4731":90,"20160310-50289-12846-s-4732":120,"20160310-50289-12846-s-3926":60,"20160310-50292-12846-s-4058":239.85,"20160310-50289-12846-s-4712":143,"20160310-50289-12846-s-4713":133.26,"20160310-50292-12837-s-9861":131,"20160310-50292-12837-s-9859":90,"20160310-50292-12834-s-10787":55,"20160310-50292-12834-s-11518":70,"20160310-50292-12837-s-9831":60,"20160310-50292-12837-s-9841":50,"20160310-50292-12834-s-11519":60,"20160310-50289-12834-s-6627":184,"20160310-50292-12834-s-11523":102,"20160310-50292-12834-s-11725":60,"20160310-50289-12834-s-6634":7,"20160310-50289-12834-s-6635":7,"20160310-50292-12837-s-10024":99.67,"20160310-50289-12837-s-7819":99.55}},{}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i["default"]={controller:null,mapController:null,buildingPreviewController:null,buildingCanvasController:null,cityCanvasController:null,cityCanvasStatusController:null,map:null}},{}],13:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s={positionZ:30,minZ:1},o=function(){function e(t){n(this,e),this.$element=t}return a(e,[{key:"init",value:function(){this.$element.on("mousedown",this.mousedown.bind(this)),this.$element.on("mouseup",this.mouseup.bind(this)),this.$element.on("mousemove",this.mousemove.bind(this)),this.$element.on("mousewheel",this.mousewheel.bind(this)),this.$element.on("touchstart",this.touchstart.bind(this)),this.$element.on("touchend",this.touchend.bind(this)),this.$element.on("touchcancel",this.touchend.bind(this)),this.$element.on("touchmove",this.touchmove.bind(this)),this.$element.on("gesturestart",this.gesturestart.bind(this)),this.$element.on("gestureend",this.gestureend.bind(this)),this.$element.on("gesturechange",this.gesturechange.bind(this)),this.handlingGesture=!1}},{key:"dispose",value:function(){this.$element.off("mousedown"),this.$element.off("mousemove"),this.$element.off("mouseup"),this.$element.off("mousewheel"),this.$element.off("touchstart"),this.$element.off("touchend"),this.$element.off("touchcancel"),this.$element.off("touchmove"),this.$element.off("gesturestart"),this.$element.off("gestureend"),this.$element.off("gesturechange")}},{key:"setCamera",value:function(e){this.camera=e,this.prevX=-1,this.prevY=-1,this.firstY=this.camera.position.y,this.firstZ=this.camera.position.z,this.firstYZRate=this.firstY/this.firstZ,this.firstRotationX=this.camera.rotation.x}},{key:"setCameraPosition",value:function(e,t){this.camera.position.x=e,this.camera.position.y=this.camera.position.z*this.firstYZRate+t}},{key:"update",value:function(){}},{key:"mousedown",value:function(e){return 1&e.buttons&&(this.prevX=e.offsetX,this.prevY=e.offsetY),!1}},{key:"mouseup",value:function(){return!1}},{key:"mousemove",value:function(e){var t=void 0,i=void 0;if("touchmove"===e.type){if(e.touches){var n=e.touches[0];t=n.clientX-n.target.offsetLeft,i=n.clientY-n.target.offsetTop}}else"mousemove"===e.type&&1&e.buttons&&(t=e.offsetX,i=e.offsetY);if(void 0!==t){var a=this.camera.position.z/s.positionZ;2>a&&(a=2),this.camera.position.x-=(t-this.prevX)/10*a,this.camera.position.y+=(i-this.prevY)/10*a,this.prevX=t,this.prevY=i}return!1}},{key:"mousewheel",value:function(e){var t=void 0,i=void 0;return void 0!==e.originalEvent.scale?(t=this.gestureStartCameraZ/e.originalEvent.scale,i=t*this.firstYZRate):0!=e.originalEvent.deltaY&&(t=this.camera.position.z+e.originalEvent.deltaY/10,i=this.camera.position.y+e.originalEvent.deltaY/10*this.firstYZRate),void 0!==t&&(t<s.minZ?(t=s.minZ,this.camera.position.z=t):(this.camera.position.z=t,this.camera.position.y=i),t<5+s.minZ?this.camera.rotation.x=Math.PI/2-(Math.PI/2-this.firstRotationX)*((t-s.minZ)/5):this.camera.rotation.x=this.firstRotationX),!1}},{key:"touchstart",value:function(e){if(e.touches){var t=e.touches[0];this.prevX=t.clientX-t.target.offsetLeft,this.prevY=t.clientY-t.target.offsetTop}}},{key:"touchend",value:function(){}},{key:"touchmove",value:function(e){return this.handlingGesture||this.mousemove(e),!1}},{key:"gesturestart",value:function(){this.gestureStartCameraZ=this.camera.position.z,this.handlingGesture=!0}},{key:"gestureend",value:function(){var e=this;setTimeout(function(){e.handlingGesture=!1},200)}},{key:"gesturechange",value:function(e){return this.mousewheel(e),!1}}]),e}();i["default"]=o},{}],14:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var i=e.geometry.coordinates,n=e.geometry.type;"MultiPolygon"===n?s(i,t):"Polygon"===n&&o(i,t)}function s(e,t){var i=!0,n=!1,a=void 0;try{for(var s,r=e[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var l=s.value;o(l,t)}}catch(u){n=!0,a=u}finally{try{!i&&r["return"]&&r["return"]()}finally{if(n)throw a}}}function o(e,t){r(e[0],t)}function r(e,t){var i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var r=s.value;r[0]<t.west&&(t.west=r[0]),r[1]<t.south&&(t.south=r[1]),r[0]>t.east&&(t.east=r[0]),r[1]>t.north&&(t.north=r[1])}}catch(l){n=!0,a=l}finally{try{!i&&o["return"]&&o["return"]()}finally{if(n)throw a}}}function l(e){if(!e.geometries){e.geometries={};var t=!0,i=!1,n=void 0;try{for(var a,s=e.geo.features[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var o=a.value,r=new m["default"](o,e),l=o.properties.type,u=o.properties.fid,c=r.height,d=new THREE.ExtrudeGeometry(r.shape,{amount:c,bevelThickness:.1,bevelSize:.1,bevelSegments:1,bevelEnabled:!0,curveSegments:1,steps:1}),h=new THREE.Mesh(d,null),f=p["default"].getElevation(r,e);h.position.z+=f,e.buildings||(e.buildings={}),e.buildings[u]=r,e.geometries[l]||(e.geometries[l]=new THREE.Geometry),e.geometries[l].mergeMesh(h)}}catch(g){i=!0,n=g}finally{try{!t&&s["return"]&&s["return"]()}finally{if(i)throw n}}}}function u(e){if(!e.meshes){e.meshes={};for(var t in e.geometries){var i=void 0;switch(e.geometries[t].computeVertexNormals(),t=parseInt(t)){case 0:i=16777024;break;case 1:i=10878883;break;case 2:i=16742405;break;case 3:i=10541295}var n=new THREE.MeshPhongMaterial({color:1118481,emissive:i,emissiveIntensity:.2,reflectivity:.7,envMap:h["default"].cityCanvasController.envMap}),a=new THREE.Mesh(e.geometries[t],n);e.meshes[t]=a}}}function c(e){if(e.meshes)for(var t in e.meshes)h["default"].cityCanvasController.scene.add(e.meshes[t])}Object.defineProperty(i,"__esModule",{value:!0});var d=e("index/models/stage/stage"),h=n(d),f=e("index/models/stage/Building"),m=n(f),g=e("./projectionUtil"),v=n(g),y=e("./heightPredictionUtil"),p=n(y);i["default"]={updateCity:function(e){if(e.geo){e.south=1e3,e.west=1e3,e.north=-1e3,e.east=-1e3;var t=!0,i=!1,n=void 0;try{for(var s,o=e.geo.features[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var r=s.value;a(r,e)}}catch(l){i=!0,n=l}finally{try{!t&&o["return"]&&o["return"]()}finally{if(i)throw n}}e.deltaLat=e.north-e.south,e.deltaLng=e.east-e.west,e.center={lat:e.north-e.deltaLat/2,lng:e.east-e.deltaLng/2};var u=v["default"].getMeterFromDeltaLng(e.east-e.center.lng,e.center.lat)/10,c=v["default"].getMeterFromDeltaLat(e.north-e.center.lat,e.center.lat)/10;e.bounds={start:{x:-u,y:-c},end:{x:u,y:c}};var d=new THREE.BoxGeometry(2*u,2*c,.5),h=new THREE.MeshBasicMaterial({color:2236962}),f=new THREE.Mesh(d,h);e.ground={mesh:f}}},addCityToScene:function(e){l(e),u(e),c(e)}}},{"./heightPredictionUtil":17,"./projectionUtil":18,"index/models/stage/Building":8,"index/models/stage/stage":12}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i["default"]={getPixelRatio:function(){return void 0!==window.devicePixelRatio?window.devicePixelRatio:1}}},{}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i["default"]={isFacebookApp:function(){return-1!==window.navigator.userAgent.toLowerCase().indexOf("fban/fbios;fbav")}}},{}],17:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,i){var n=e.properties.type,a=1;switch(n){case 0:a=1;break;case 1:a=2;break;case 2:a=.5;break;case 3:a=6}return 0!==n&&1!==n&&2!==n||(a=s(t,i)),a>u[n]?a=u[n]:a<c[n]&&(a=c[n]),a}function s(e,t){return o(e,t.dsm)-o(e,t.dem)}function o(e,t){var i=e.center.lng-t.lng,n=e.center.lat-t.lat,a=Math.floor(i/t.size),s=Math.floor(n/t.size),o=t.lng%t.size,r=t.lat%t.size;return o-t.size/2>0&&a++,r-t.size/2>0&&s++,t.points[s][a]/10}Object.defineProperty(i,"__esModule",{value:!0});var r=e("index/models/stage/heightByHand"),l=n(r),u={0:1.5,1:30,2:.5,3:20},c={0:.5,1:1.5,2:.3,3:1.5};i["default"]={getHeight:function(e,t,i){return void 0!==l["default"][e.properties.fid]?l["default"][e.properties.fid]/10:a(e,t,i)},getElevation:function(e,t){return o(e,t.dem)}}},{"index/models/stage/heightByHand":11}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=6378137,a=.0818191910428;i["default"]={getMeterFromDeltaLat:function(e,t){var i=t*Math.PI/180;return n*(1-Math.pow(a,2))/Math.pow(1-Math.pow(a,2)*Math.pow(Math.sin(i),2),1.5)*(e*Math.PI/180)},getMeterFromDeltaLng:function(e,t){var i=t*Math.PI/180;return n*Math.cos(i)/Math.sqrt(1-Math.pow(a,2)*Math.pow(Math.sin(i),2))*(e*Math.PI/180)}}},{}]},{},[1]);</script><script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCsCy6ieDrZgPDMgZjUTK2WqAyBGn3SdII&callback=initMap" async defer="defer"></script><script src="/assets/js/analytics.js"></script></body></html>