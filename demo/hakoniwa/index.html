<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@knt5"><meta name="twitter:creator" content="@knt5"><meta name="twitter:title" content="Hakoniwa"><meta name="twitter:description" content="Real Minecraft, 3D visualizer of elevation data including the height of buildings which was recorded by the Satellite of JAXA"><meta name="twitter:image:src" content="https://knt5.github.io/assets/img/twitter/summary-large-image/hakoniwa.jpg"><meta property="fb:app_id" content="824397874371935"><meta property="og:url" content="https://knt5.github.io/demo/hakoniwa/"><meta property="og:type" content="website"><meta property="og:title" content="Hakoniwa"><meta property="og:description" content="Real Minecraft, 3D visualizer of elevation data including the height of buildings which was recorded by the Satellite of JAXA"><meta property="og:image" content="https://knt5.github.io/assets/img/twitter/summary-large-image/hakoniwa.jpg"><meta property="og:image:width" content="560"><meta property="og:image:height" content="300"><title>Hakoniwa</title><link rel="icon" type="image/png" href="assets/img/favicon.png"><link rel="apple-touch-icon" type="image/png" href="assets/img/favicon.png"><style>html,body,div,span,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,abbr,address,cite,code,del,dfn,em,img,ins,kbd,q,samp,small,strong,sub,sup,var,b,i,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,figcaption,figure,footer,header,hgroup,menu,nav,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}ol,ul{padding-left:20px}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}nav ul{list-style:none}blockquote,q{quotes:none}blockquote::before,blockquote::after,q::before,q::after{content:none}a{margin:0;padding:0;font-size:100%;vertical-align:baseline;background:transparent}ins{background-color:#ff9;color:#000;text-decoration:none}mark{background-color:#ff9;color:#000;font-style:italic;font-weight:bold}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}hr{display:block;height:1px;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}input,select{vertical-align:middle}*,*::before,*::after{box-sizing:border-box}body{background:#000;color:#fff;font-size:18px;line-height:1.4;-webkit-text-size-adjust:100%}body,input,select,textarea,th,td{font-family:"Myriad Pro", "Lucida Grande", "GillSans", "Hiragino Kaku Gothic Pro", "Meiryo", "sans-serif"}a{color:#39f}a:link,a:visited,a:active{text-decoration:none}a:hover{text-decoration:underline}.clearfix::after{content:'';display:block;clear:both}.hidden{display:none}.main{position:relative;background:#000}.stage{position:relative;background-image:linear-gradient(to top, #434343, #000)}.header{position:absolute;top:0;left:0;padding:10px 15px;z-index:9000}.header h1{font-size:38px;font-weight:normal}.header p{font-size:12px}.facebook{margin-top:8px}.message{margin-top:4px;font-size:14px}.error{margin-top:4px;font-size:14px;color:#f00}.dat-gui{position:absolute;bottom:20px;left:0;z-index:9000}.map{position:absolute;bottom:0;right:0;width:300px;height:200px;z-index:9000}@media (max-width: 414px){.map{width:100%;height:120px}.github-ribbon img{width:74px;height:74px}.header h1{font-size:24px}}</style></head><body><canvas id="dsm-canvas" class="hidden"></canvas><canvas id="mask-canvas" class="hidden"></canvas><canvas id="work-canvas" class="hidden"></canvas><canvas id="work-mask-canvas" class="hidden"></canvas><div id="main" class="main"><div id="stage" class="stage"></div><header class="header"><h1>Hakoniwa</h1><p>JAXA ALOS DSM 3D visualizer Â© <a href="https://knt5.github.io/" target="_blank">knt5</a></p><div class="facebook"><iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fknt5.github.io%2Fdemo%2Fhakoniwa%2F&width=164&layout=button_count&action=like&show_faces=false&share=true&height=46&appId=824397874371935" width="164" height="46" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowtransparency="true"></iframe></div><div id="message" class="message"></div><div id="error" class="error"></div></header><div id="dat-gui" class="dat-gui"></div><div id="map" class="map"></div></div><div class="github-ribbon"><a href="https://github.com/knt5/hakoniwa"><img style="position: absolute; top: 0; right: 0; border: 0" src="https://camo.githubusercontent.com/52760788cde945287fbb584134c4cbc2bc36f904/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"></a></div><script src="assets/js/lib/jquery.min.js?v=3.0.0"></script><script src="assets/js/lib/three.min.js?v=r76"></script><script src="assets/js/lib/TrackballControls.js"></script><script src="assets/js/lib/dat.gui.min.js?v=0.5.1"></script><script>function initMap(){var e=config.dsm,t=config.work;map=new google.maps.Map($map.get(0),{center:{lat:t.north,lng:t.west},zoom:12});var a={north:e.north,south:e.south,east:e.east,west:e.west},o=new google.maps.GroundOverlay(e.path,a);o.setOpacity(.8),o.setMap(map),hakoniwa.init()}var config={dsm:{path:"assets/dsm/N035E139.tokyo.png",maskPath:"assets/dsm/N035E139.tokyo.mask.png",north:35.76,east:139.81,south:35.61,west:139.68,pixelSize:.000277777778,image:null,maskImage:null},work:{width:50,height:50,north:35.633678619189524,west:139.72721500523392},cube:{size:3},gui:{autoPilotEnabled:!0,autoPilotSpeed:1,elevationScale:4,wireframe:!1,roughness:.5,metalness:.5}},$window=$(window),$stage=$("#stage"),$dsmCanvas=$("#dsm-canvas"),$maskCanvas=$("#mask-canvas"),$workCanvas=$("#work-canvas"),$workMaskCanvas=$("#work-mask-canvas"),$datGui=$("#dat-gui"),$map=$("#map"),$message=$("#message"),$error=$("#error"),map,camera,renderer,dsmContext=$dsmCanvas.get(0).getContext("2d"),maskContext=$maskCanvas.get(0).getContext("2d"),workContext=$workCanvas.get(0).getContext("2d"),workMaskContext=$workMaskCanvas.get(0).getContext("2d");$(document).ready(function(){function e(){var e=$window.height();-1!=window.navigator.userAgent.toLowerCase().indexOf("fban/fbios;fbav")&&$window.width()<=414&&(e-=100),$stage.height(e),camera&&renderer&&(camera.aspect=$stage.width()/$stage.height(),camera.updateProjectionMatrix(),renderer.setSize($stage.width(),$stage.height()))}$window.on("resize",e),e(),$workCanvas.width(config.work.width),$workCanvas.height(config.work.height),$workCanvas.prop("width",config.work.width),$workCanvas.prop("height",config.work.height),$workMaskCanvas.width(config.work.width),$workMaskCanvas.height(config.work.height),$workMaskCanvas.prop("width",config.work.width),$workMaskCanvas.prop("height",config.work.height);var t=new Image;t.src=config.dsm.path,t.onload=function(){var e=t.width,a=t.height;$dsmCanvas.width(e),$dsmCanvas.height(a),$dsmCanvas.prop("width",e),$dsmCanvas.prop("height",a),dsmContext.drawImage(t,0,0),config.dsm.image=t,hakoniwa.init()};var a=new Image;a.src=config.dsm.maskPath,a.onload=function(){var e=a.width,t=a.height;$maskCanvas.width(e),$maskCanvas.height(t),$maskCanvas.prop("width",e),$maskCanvas.prop("height",t),maskContext.drawImage(a,0,0),config.dsm.maskImage=a,hakoniwa.init()}});var mapUtil=function(){function e(){var e=[{lat:i.south,lng:i.east},{lat:i.north,lng:i.east},{lat:i.north,lng:i.west},{lat:i.south,lng:i.west}];new google.maps.Polygon({map:map,paths:e,strokeColor:"#666666",strokeOpacity:1,strokeWeight:2,fillColor:"#ffcccc",fillOpacity:.2,draggable:!1,geodesic:!0}),o=new google.maps.Polygon({map:map,paths:t(),strokeColor:"#ff0000",strokeOpacity:1,strokeWeight:2,fillColor:"#ff0000",fillOpacity:.3,draggable:!0,geodesic:!0}),o.addListener("dragend",function(){var e=o.getPath().getAt(0);n.north=e.lat(),n.west=e.lng(),console.log(n),hakoniwa.update()})}function t(){var e=i.pixelSize*n.width,t=i.pixelSize*n.height,a=n.north,o=n.west,r=[{lat:a,lng:o},{lat:a,lng:o+e},{lat:a-t,lng:o+e},{lat:a-t,lng:o}];return r}function a(){map.setCenter({lat:n.north,lng:n.west}),o.setPath(t())}var o,i=config.dsm,n=config.work;return{addPolygons:e,updateWorkAreaPosition:a}}(),hakoniwa=function(){function e(){return!(!c.image||!c.maskImage||"undefined"==typeof google)}function t(){return(f.west-c.west)/c.pixelSize}function a(){return(c.north-f.north)/c.pixelSize}function o(e,t){var a=[10025880,10145074,3329330,14596231,14329120,13468991,13789470,10506797,9127187,8388608],o=20,i=10;if(0!==t)return 3711451;for(var n=0;n<a.length;n++)if(n*i+o>e)return a[n];return 8388608}function i(){var e=dsmContext.getImageData(t(),a(),f.width,f.height);if(workContext.fillStyle="#000",workContext.fillRect(0,0,f.width,f.height),workContext.putImageData(e,0,0),c.maskImage){var o=maskContext.getImageData(t(),a(),f.width,f.height);workMaskContext.fillStyle="#000",workMaskContext.fillRect(0,0,f.width,f.height),workMaskContext.putImageData(o,0,0)}}function n(){var e,t;for(x=[],t=0;t<f.height;t++)for(x.push([]),e=0;e<f.width;e++){var a=new THREE.BoxGeometry(u,u,u),o=new THREE.MeshStandardMaterial,i=new THREE.Mesh(a,o);i.matrixAutoUpdate=!1,i.rotationAutoUpdate=!1,i.position.x=(e-f.width/2)*u,i.position.z=(t-f.height/2)*u,p.add(i),x[t].push(i)}}function r(){var e,t,a=workContext.getImageData(0,0,f.width,f.height),i=workMaskContext.getImageData(0,0,f.width,f.height),n=!1,r=!1,s=!1;for(t=0;t<f.height;t++)for(e=0;e<f.width;e++){var h=a.data[4*e+t*f.width*4],d=i.data[4*e+t*f.width*4],g=x[t][e],w=o(h,d);w!==g.material.color.getHex()&&g.material.color.setHex(w),0===e&&0===t&&((k.wireframe&&!g.material.wireframe||!k.wireframe&&g.material.wireframe)&&(n=!0),g.material.roughness!==k.roughness&&(r=!0),g.material.metalness!==k.metalness&&(s=!0)),n&&(g.material.wireframe=!g.material.wireframe),r&&(g.material.roughness=k.roughness),s&&(g.material.metalness=k.metalness),g.scale.y=h/3*(.1*k.elevationScale),g.position.y=h/2*(.1*k.elevationScale),g.updateMatrix()}}function s(){return!($stage.width()>320)}function h(){i(),r(),mapUtil.updateWorkAreaPosition()}function d(){if(e()){mapUtil.addPolygons(),i(),p=new THREE.Scene,p.autoUpdate=!1,p.fog=new THREE.Fog(16777215,80,400),camera=new THREE.PerspectiveCamera(45,$stage.width()/$stage.height(),1,1e3),camera.position.set(C/1.7,C/1.4,C),camera.lookAt(p.position),renderer=new THREE.WebGLRenderer,renderer.setSize($stage.width(),$stage.height()),$stage.append(renderer.domElement),m=new THREE.TrackballControls(camera,$stage.get(0)),m.staticMoving=!0;var t=new THREE.DirectionalLight(16777215);t.position.set(0,100,20),t.castShadow=!0,p.add(t);var a;if(s()?(a=new THREE.AmbientLight(16777215),p.add(a)):(a=new THREE.AmbientLight(10066329),p.add(a)),!s()){var o=new THREE.SphereGeometry(.5,16,8);v.push(new THREE.PointLight(16744448,3,150)),v[0].position.set($,20,$),v[0].add(new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:16744448}))),p.add(v[0]),v.push(new THREE.PointLight(16777088,2,150)),v[1].position.set($,20,$),v[1].add(new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:16777088}))),p.add(v[1])}var h=new THREE.AxisHelper(120);p.add(h);var d=new THREE.GridHelper(100,5);p.add(d);var g=new THREE.DirectionalLightHelper(t);p.add(g),n(),r(),requestAnimationFrame(l)}}function g(){k.autoPilotEnabled&&(S.up?(f.north+=c.pixelSize*k.autoPilotSpeed,f.north>=c.north&&(S.reachedTop=!0),(f.north>=c.north||f.north>=S.turned.north+c.pixelSize*f.height)&&(S.up=!1,f.north-=c.pixelSize*k.autoPilotSpeed,S.prevLeft?(S.right=!0,S.prevLeft=!1):(S.left=!0,S.prevLeft=!0))):S.down?(f.north-=c.pixelSize*k.autoPilotSpeed,f.north-c.pixelSize*f.height<=c.south&&(S.down=!1,f.north+=c.pixelSize*k.autoPilotSpeed,S.prevLeft?(S.right=!0,S.prevLeft=!1):(S.left=!0,S.prevLeft=!0))):S.right?(f.west+=c.pixelSize*k.autoPilotSpeed,f.west+c.pixelSize*f.width>=c.east&&(S.right=!1,f.west-=c.pixelSize*k.autoPilotSpeed,S.reachedTop?(S.down=!0,S.reachedTop=!1):S.up=!0,S.turned.north=f.north,S.turned.west=f.west)):S.left&&(f.west-=c.pixelSize*k.autoPilotSpeed,f.west<=c.west&&(S.left=!1,f.west+=c.pixelSize*k.autoPilotSpeed,S.reachedTop?(S.down=!0,S.reachedTop=!1):S.up=!0,S.turned.north=f.north,S.turned.west=f.west)))}function w(){v.length>=2&&(E+=.1,v[0].position.x=$*Math.sin(E),v[0].position.y=$/2*(Math.sin(.3*E)+1),v[0].position.z=$*Math.cos(.8*E),v[1].position.x=$*Math.sin(.9*-E),v[1].position.y=$/2*(Math.sin(.2*-E)+1),v[1].position.z=$*Math.cos(-E)),k.autoPilotEnabled&&(g(),h()),m.update(),p.updateMatrixWorld(),renderer.render(p,camera)}function l(){w(),requestAnimationFrame(l)}var p,m,c=config.dsm,u=config.cube.size,f=config.work,k=config.gui,v=[],$=70,C=145,E=-1,x=[],S={up:!1,down:!1,right:!0,left:!1,turned:{north:0,west:0},reachedTop:!1,prevLeft:!1},M=new dat.GUI({autoPlace:!1});return M.add(k,"autoPilotEnabled"),M.add(k,"autoPilotSpeed",.5,30),M.add(k,"elevationScale",1,10),M.add(k,"wireframe"),M.add(k,"roughness",0,1),M.add(k,"metalness",0,1),$datGui.append(M.domElement),{init:d,update:h}}();</script><script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCsCy6ieDrZgPDMgZjUTK2WqAyBGn3SdII&callback=initMap" async defer="defer"></script><script src="/assets/js/analytics.js"></script></body></html>